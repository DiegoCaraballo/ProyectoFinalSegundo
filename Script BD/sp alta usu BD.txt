

Create Procedure AltaUsuSql @nomUsu varchar(15), @pass varchar(7), @Rol varchar(30) AS
Begin
	
	--primero creo el usuario de logueo
	Declare @VarSentencia varchar(200)
	Set @VarSentencia = 'CREATE LOGIN [' +  @nombre + '] WITH PASSWORD = ' + QUOTENAME(@pass, '''')
	Exec (@VarSentencia)
	
	if (@@ERROR <> 0)
		return -1
		
	
	--segundo asigno rol especificao al usuario recien creado
	Exec sp_addsrvrolemember @loginame=@nombre, @rolename=@Rol
	
	if (@@ERROR = 0)
		return 1
	else
		return -2

End
go

Create Procedure AltaUsuBD @nombre varchar(15), @Rol varchar(30), @logueo varchar(10) AS
Begin
	--primero creo el usuario 
	Declare @VarSentencia varchar(200)
	Set @VarSentencia = 'Create User [' +  @nombre + '] From Login [' + @logueo + ']'
	Exec (@VarSentencia)
	
	if (@@ERROR <> 0)
		return -1
		
	
	--segundo asigno rol especificao al usuario recien creado
	Exec sp_addrolemember @rolename=@rol, @membername=@nombre
	
	if (@@ERROR = 0)
		return 1
	else
		return -2
	

End
go


